{% extends "sales/base.html" %}

{% block extrahead %}
<script type="application/javascript">
    $(function(){
        //$('.selectable').selectable();
    });
    
    function fillbox(box){
        if($('#cutselected').length & $('#orderselected').length){
            var cutorder = $('#cutselected').attr('data-cutorder');
            var ordersku = $('#orderselected').attr('data-ordersku');
            var box = $(box).attr('data-box');
            $.get('/shipping/shipmentsku/', {'shirtorderskuid':ordersku, 'cutorder':cutorder, 'box':box, 'prefix':'1'}, function(data){
                $('#box' + box).append(data);
                deselect();
            });
        }
    }
    
    function deselect(){
        $('#cutselected, #orderselected').attr('id','');
        $('.cut').addClass('unselectable');
    }

    function choosecolor(shirtstyleid, shirtstylevariationid, colorid){
        var customeraddressid = {{ customeraddressid }};
        if(shirtstylevariationid===null)
            shirtstylevariationid=0;
        $.getJSON('/data/shippingorderskus/', {'shirtstyleid':shirtstyleid, 'variationid':shirtstylevariationid, 'colorid':colorid, 'addressid':customeraddressid}, function(data){
            var orderlist = ""
            var cutlist = ""
            $.each(data, function(i, item) {
                orderlist += "<li id='" + item.ShirtPrice + "'>Shirt Size: " + item.abbr + " - Inventory: " + item.total + "<ul>";
                cutlist += "<li id='" + item.ShirtPrice + "'>Shirt Size: " + item.abbr + " - Inventory: " + item.total + "<ul>";
                $.each(item.orderedpieces, function(i, po) {
                    orderlist += "<li class='orderselectable' data-shirtprice='" + po.shirtprice + "' data-ordersku='" + po.shirtordersku + "'>PO#" + po.ponumber + " - " + po.orderquantity + " Shirts</li>";
                });
                $.each(item.cutpieces, function(i, cut) {
                    cutlist += "<li class='cut unselectable' data-shirtprice='" + cut.shirtprice + "' data-cutorder='" + cut.cutorder + "'>cut#" + cut.cutorder + " - " + cut.inventory + " Shirts</li>";
                });
                orderlist += "</ul></li>";
                cutlist += "</ul></li>";
            });
            orderlist += "</li>";
            $('#orderlist').html(orderlist);
            $('#cutlist').html(cutlist);
            $('.orderselectable').click(function(){
                $('#orderselected').attr('id','');
                $(this).attr('id','orderselected');
                $('.cut').addClass('unselectable');
                $('#cutselected').attr('id','');
                $(".cut[data-shirtprice='" + $(this).attr('data-shirtprice') + "']").removeClass('unselectable');
            });
            $('.cut').click(function(){
                if($(this).hasClass('unselectable')){
                    alert('you must select inventory of the same size!');
                }
                else {
                    $('#cutselected').attr('id','');
                    $(this).attr('id','cutselected');
                }
            });
        });
    }
</script>
<style type="text/css">
    #orderlist {
        float:left;
    }
    #cutlist {
        float:right;
    }
    .orderselectable, .cut {
        cursor:pointer;
    }
    #orderselected, #cutselected {
        background-color:yellow;
    }
    .unselectable {
        color:gray;
    }
    #boxes {
        float:left;
    }
    .box {
        border:1px solid black;
    }
</style>
{% endblock %}

{% block body %}
{% regroup ordercolors by parentstyle as parentstyles %}
    <ul>
    {% for parentstyle in parentstyles %}
        <li>{{ parentstyle.grouper }}
            <ul>
                {% for color in parentstyle.list %}
                    <li><a href="#" onClick="choosecolor({{ color.ShirtPrice__ShirtStyle }},{{ color.ShirtStyleVariation|default:'null' }},{{ color.Color.id }})">{{ color.Color }}</a></li>
                {% endfor %}
            </ul>
        </li>
    {% endfor %}
    </ul>
    
    <ul id='orderlist'></ul>
    <div id='boxes'>
        <table class='box' id='box1' data-box='1' onClick='fillbox(this)'>
            <tr>
                <th>SKU</th>
                <th>PO</th>
                <th>CO</th>
                <th>Quantity</th>
            </tr>
        </table>
    </div>
    <ul id='cutlist'></ul>
{% endblock %}
